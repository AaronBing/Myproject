# STM32获取最佳的ADC精度

ADC精度不仅取决于ADC性能和功能，还取决于ADC周围的整体应用设计。

本笔记主要包括三个部分：
	ADC内部结构简述
	导致ADC误差的原因
	从硬件和软件最小化ADC误差的建议




1、ADC内部原理
使用SAR(逐次逼近)原则，分多步执行转换。
转换的步数等于ADC转换器的位数。
每个步骤有ADC时钟驱动。
每个ADC时钟从结果到输出产生一位。
ADC的内部设计基于切换电容技术。



2、ADC误差
精度误差表达为1LSB的倍数。
分辨率取决于参考电压
通过将LSB数乘以1 LSB对应的电压来计算电压误差
 1 LSB = VREF+/2^12或VDDA/2^12


2.1、ADC自身导致的误差

2.1.1 偏移误差
偏移误差是第一次实际转换和第一次理想转换之间的偏离。
第一次转换发生在数字ADC输出从0变为1时。

当模拟输入介于0.5 LSB和1.5 LSB之间时，数字输出应为1。
仍然是理想情况下，第一次转换发生在0.5 LSB处。用EO表示偏移误差。可通过应用固件轻松校准偏移误差

	1 LSB = VREF+/4096
	如果VREF = 3.3V,  0.5LSB=402.8 uV，
	那么超过402uV便应该置为1,。
	但实际上，ADC仍然可能为0，
	当模拟输入为550uV时，才输出1。
	
	则：偏移误差=实际转换-理想转换
	EO= 550 μV C 402.8 μV = 141.2 μV
	EO = 141.2 μV / 805.6 μV = 0.17 LSB


2.1.2、增益误差
增益误差是最后一次实际转换和最后一次理想转换之间的偏离。增益误差用EG表示。
最后一次实际转换是从0xFFE到0xFFF的转换。

	EG = 最后一次实际转换 C 理想转换



2.1.3、微分线性误差
微分线性误差（ DLE）为实际步进和理想步进之间的最大偏离。
这里的“理想情况”不是
指理想传输曲线，而是指ADC分辨率。用ED表示DLE。

	ED = 实际步宽 C 1 LSB



2.1.4、积分线性误差
积分线性误差为任何实际转换和端点相关线间的最大偏离。用EL表示ILE。
ILE也称为积分非线性（ INL）误差。 ILE是整个范围内DLE的积分。


2.1.5、总未调整误差
总未调整误差（ TUE）为实际和理想传输曲线间的最大偏离。
用ET表示TUE。
TUE不是EO、 EG、 EL与ED之和。偏移误差影响较低电压的数字结果，而增益误差影响较高电压的数字输出






2.2、ADC环境导致的误差

2.2.1 参考电压噪声

SMPS（开关模式电源）通常内置快速切换功率晶体管。这会在输出中产生高频噪声。此切换噪声介于15 kHz至1 MHz之间。


2.2.2 参考电压/电源调节

电源调节对于ADC精度十分重要，因为转换结果是模拟输入电压与VREF+值之比。

当连接到VDDA或VREF+时，如果这些输入上的负载及其输出阻抗导致电源输出下降，将在转换结果中产生误差。


2.2.3 外部参考电压参数

温度漂移、电压噪声和长期稳定性。


2.2.4 模拟输入信号噪声
在采样时间内，小而高频率的信号变化可导致较大转换误差。


2.2.5 最大输入信号幅度的ADC动态范围匹配不佳
例如只使用0-2.5v，那么采样2.5到3.3v的区间未使用，导致转换后信号精度下降。


2.2.6模拟信号源电阻的影响
――――――――――――――――――――――――――――――――暂时看到这里p18


3、如何得到最佳ADC精度








